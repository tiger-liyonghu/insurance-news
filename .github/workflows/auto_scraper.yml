name: 自动抓取保险欺诈案例

# 工作流触发条件：每小时运行一次
on:
  schedule:
    # Cron 表达式：UTC 时间，每小时的第 0 分钟执行
    # 例如：北京时间 9:00 = UTC 1:00
    - cron: '0 * * * *'
  
  # 允许手动触发（在 GitHub Actions 页面点击 "Run workflow"）
  workflow_dispatch:

jobs:
  scrape-fraud-cases:
    runs-on: ubuntu-latest
    
    steps:
      # 步骤1: 检出代码
      - name: 检出代码
        uses: actions/checkout@v3
      
      # 步骤2: 设置 Python 环境
      - name: 设置 Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      # 步骤3: 安装依赖
      - name: 安装依赖包
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      # 步骤4: 运行抓取脚本
      - name: 执行抓取脚本
        env:
          # 从 GitHub Secrets 读取 API Key
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          python agent.py
      
      # 步骤5: 输出执行结果（可选）
      - name: 完成提示
        run: |
          echo "✅ 抓取任务完成！"
